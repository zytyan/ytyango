// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: query_pics.sql

package q

import (
	"context"
)

const getPicByRateAndRandKey = `-- name: getPicByRateAndRandKey :one

SELECT file_id
FROM saved_pics
WHERE user_rate = ?
  AND rand_key > ?
LIMIT 1
`

// encoding: utf-8
func (q *Queries) getPicByRateAndRandKey(ctx context.Context, userRate int64, randKey int64) (string, error) {
	row := q.db.QueryRowContext(ctx, getPicByRateAndRandKey, userRate, randKey)
	var file_id string
	err := row.Scan(&file_id)
	return file_id, err
}

const getPicByRateFirst = `-- name: getPicByRateFirst :one
SELECT file_id
FROM saved_pics
WHERE user_rate = ?
ORDER BY rand_key
LIMIT 1
`

func (q *Queries) getPicByRateFirst(ctx context.Context, userRate int64) (string, error) {
	row := q.db.QueryRowContext(ctx, getPicByRateFirst, userRate)
	var file_id string
	err := row.Scan(&file_id)
	return file_id, err
}

const insertPic = `-- name: insertPic :exec
INSERT INTO saved_pics (file_uid, file_id, bot_rate, rand_key, user_rate)
VALUES (?, ?, ?, ?, ?)
ON CONFLICT(file_uid) DO UPDATE SET file_id   = excluded.file_id,
                                    bot_rate  = excluded.bot_rate,
                                    user_rate =
                                        CASE
                                            WHEN excluded.rate_user_count = 0
                                                THEN excluded.bot_rate
                                            ELSE
                                                excluded.user_rate
                                            END
`

type insertPicParams struct {
	FileUid  string `json:"file_uid"`
	FileID   string `json:"file_id"`
	BotRate  int64  `json:"bot_rate"`
	RandKey  int64  `json:"rand_key"`
	UserRate int64  `json:"user_rate"`
}

func (q *Queries) insertPic(ctx context.Context, arg insertPicParams) error {
	_, err := q.db.ExecContext(ctx, insertPic,
		arg.FileUid,
		arg.FileID,
		arg.BotRate,
		arg.RandKey,
		arg.UserRate,
	)
	return err
}

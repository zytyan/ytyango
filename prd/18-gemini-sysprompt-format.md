# **产品需求文档**

## **产品名称：Gemini 系统提示词模板格式化迁移**

## **版本：v1.0**

## **撰写日期：2026-01-10**


## **1. 背景（Background）**

Gemini 系统提示词当前在 handlers/gemini_ai.go 中直接内嵌 fmt.Sprintf 模板，维护与验证成本较高。
已有模板草稿与 replacer 变量调整，需要将格式化逻辑迁移到可维护的模板流程，并保持与现有格式一致。

---

## **2. 目标（Objectives）**

* 使用模板文件驱动系统提示词格式化。
* 使用 replacer 变量完成时间、聊天与机器人信息替换。
* 保持现有提示词内容与格式不变（除明确变更项）。

---

## **3. 非目标（Out of Scope）**

* 不引入 if/条件分支模板能力。
* 不更改 Gemini 业务流程与行为逻辑。
* 不调整 prompt 语义内容。

---

## **4. 用户角色（User Personas）**

### **维护者**

* 需要可维护的系统提示词模板与可验证的替换逻辑。

---

## **5. 用户故事（User Stories）**

1. **作为维护者，我希望系统提示词从模板文件生成，方便修改与复用。**

---

## **6. 功能需求（Functional Requirements）**

| ID   | 描述                                                     | 优先级 |
| ---- | -------------------------------------------------------- | ------ |
| FR-1 | 读取嵌入模板文件生成系统提示词                            | 高     |
| FR-2 | 通过 replacer 替换时间、聊天类型/名称、机器人名称/用户名 | 高     |
| FR-3 | 输出格式与现有提示词保持一致                             | 高     |

---

## **7. 非功能需求（Non-functional Requirements）**

* 不依赖外部服务，测试可重复运行。

---

## **8. 技术方案（Tech Design Summary）**

* handlers/gemini_ai.go 使用 go:embed 读取模板文本。
* helpers/replacer.NewReplacer 处理模板变量替换。
* 通过固定 ReplaceCtx 驱动替换，保留原有提示词内容。

---

## **9. 里程碑（Milestones）**

| 时间 | 目标                     |
| ---- | ------------------------ |
| Day 1 | PRD 与待办清单完成        |
| Day 1 | 模板迁移与测试完成        |

---

## **10. 验收标准（Acceptance Criteria）**

* gemini_ai.go 使用模板文件生成系统提示词。
* 替换变量覆盖时间、聊天与机器人信息。
* `go test ./...` 通过（若外部依赖导致失败需注明）。


# **产品需求文档**

## **产品名称：Gemini 格式化能力测试**

## **版本：v1.0**

## **撰写日期：2026-01-10**


## **1. 背景（Background）**

handlers/gemini_ai.go 中存在模板化文本输出需求，需要验证格式化能力，确保时间、聊天信息与机器人信息的格式化输出符合预期。
当前缺少对应的自动化测试覆盖。

---

## **2. 目标（Objectives）**

* 验证 Gemini 相关格式化文本的拼接结果与预期一致。
* 覆盖时间、聊天类型与名称、机器人名称与用户名的格式化输出。

---

## **3. 非目标（Out of Scope）**

* 暂不处理 if 分支逻辑（当前不支持）。
* 不调整业务逻辑或模板内容。
* 不引入新的第三方依赖。

---

## **4. 用户角色（User Personas）**

### **维护者**

* 需要测试确保提示词格式化稳定。

---

## **5. 用户故事（User Stories）**

1. **作为维护者，我希望时间、聊天与机器人信息的格式化结果稳定可验证。**

---

## **6. 功能需求（Functional Requirements）**

| ID   | 描述                                                        | 优先级 |
| ---- | ----------------------------------------------------------- | ------ |
| FR-1 | 覆盖“现在是:%s”的时间格式化输出                              | 高     |
| FR-2 | 覆盖聊天 type 与 name 的格式化输出                            | 高     |
| FR-3 | 覆盖机器人 name 与 username 的格式化输出                      | 高     |

---

## **7. 非功能需求（Non-functional Requirements）**

* 测试应可重复执行，不依赖外部服务。

---

## **8. 技术方案（Tech Design Summary）**

* 基于 Go testing 包新增单元测试。
* 构造固定 ReplaceCtx 或等价上下文，使用固定时间与固定 chat/bot 结构体。
* 校验格式化输出是否与预期字符串一致。

---

## **9. 里程碑（Milestones）**

| 时间 | 目标                   |
| ---- | ---------------------- |
| Day 1 | PRD 与待办清单完成      |
| Day 1 | 测试用例完成并通过      |

---

## **10. 验收标准（Acceptance Criteria）**

* 新增测试覆盖时间、聊天与机器人信息格式化输出。
* `go test ./...` 通过（若外部依赖导致失败需注明）。


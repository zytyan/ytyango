version: "2"
plugins:
- name: mygen
  wasm:
    url: file://sql/plugins/sqlc-gen-go.wasm
    sha256: "e899a4af7484bb2d89deb5951a35ac05a354d3e086f76a152e1317ccf7349601"
overrides:
  go:
    overrides:
      - db_type: "INT_UNIX_SEC"
        engine: "sqlite"
        go_type:
          type: "UnixTime"
      - db_type: "INT_BOOL"
        engine: "sqlite"
        nullable: false
        go_type:
          type: "bool"
      - db_type: "JSON_TEXT"
        engine: "sqlite"
        nullable: true
        go_type:
          type: "NullString"
          import: "database/sql"
sql:
  - engine: "sqlite"
    queries:
      - "sql/query_bilibili.sql"
      - "sql/query_chat.sql"
      - "sql/query_coc.sql"
      - "sql/query_pics.sql"
      - "sql/query_gemini.sql"
      - "sql/query_user.sql"
      - "sql/query_ytdl.sql"
    schema:
      - "sql/schema_bilibili.sql"
      - "sql/schema_chat.sql"
      - "sql/schema_coc.sql"
      - "sql/schema_pics.sql"
      - "sql/schema_gemini.sql"
      - "sql/schema_user.sql"
      - "sql/schema_ytdl.sql"
    codegen:
    - out: globalcfg/q
      plugin: mygen
      options:
        package: "q"
        out: "globalcfg/q"
        output_files_suffix: "_gen"
        output_db_file_name: "db_gen.go"
        output_models_file_name: "models_gen.go"
        output_batch_file_name: "batch_gen.go"
        output_querier_file_name: "querier_gen.go"
        emit_json_tags: true
        query_parameter_limit: 4
        emit_prepared_queries: true
        rename:
          chat_cfg: chatCfg
        overrides:
        - db_type: "INT_UNIX_SEC"
          engine: "sqlite"
          zap_field_method: true
          go_type:
            type: "UnixTime"
        - db_type: "INT_BOOL"
          engine: "sqlite"
          nullable: false
          go_type:
            type: "bool"
        - db_type: "JSON_TEXT"
          engine: "sqlite"
          nullable: true
          go_type:
            type: "NullString"
            import: "database/sql"
        - db_type: "BLOB_USER_TO_CNT"
          engine: "sqlite"
          go_type:
            type: UserMsgStatMap
        - db_type: "BLOB_TEN_MINUTE_STAT"
          engine: "sqlite"
          go_type:
            type: TenMinuteStats
  - engine: "sqlite"
    queries:
     - "sql/query_saved_msg.sql"
    schema:
     - "sql/schema_saved_msg.sql"
    codegen:
      - out: globalcfg/msgs
        plugin: mygen
        options:
          package: "msgs"
          out: "globalcfg/msgs"
          output_files_suffix: "_gen"
          output_db_file_name: "db_gen.go"
          output_models_file_name: "models_gen.go"
          output_batch_file_name: "batch_gen.go"
          output_querier_file_name: "querier_gen.go"
          emit_json_tags: true
          query_parameter_limit: 4
          emit_prepared_queries: true
          rename:
            chat_cfg: chatCfg
          overrides:
            - db_type: "INT_UNIX_SEC"
              engine: "sqlite"
              zap_field_method: true
              go_type:
                type: "UnixTime"
            - db_type: "INT_UNIX_SEC"
              engine: "sqlite"
              nullable: true
              zap_field_method: true
              go_type:
                type: "Null[UnixTime]"
                import: "database/sql"
            - db_type: "JSON_TEXT"
              engine: "sqlite"
              go_type:
                type: "[]byte"
            - db_type: "JSON_TEXT"
              engine: "sqlite"
              nullable: true
              go_type:
                type: '[]byte'